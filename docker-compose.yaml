services:
  client:
    env_file:
      - ./client/.env
    build: ./client
    depends_on:
      - boundary
    volumes:
      - ./client:/app

  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - "5672:5672"
      - "15672:15672"

  boundary:
    build:
      context: ./server
      dockerfile: boundary/Dockerfile
    depends_on:
      - rabbitmq
    ports:
      - "5000:5000"
    volumes:
      - ./server/boundary:/app
      - ./server/rabbitmq:/app/rabbitmq
      - ./server/common:/app/common
      
  filter_by_year_worker:
    build:
      context: ./server
      dockerfile: worker/filter_by_year/Dockerfile
    depends_on:
      - rabbitmq
    volumes:
      - ./server/worker/filter_by_year:/app
      - ./server/rabbitmq:/app/rabbitmq
      - ./server/common:/app/common
    deploy:
      replicas: 2

  filter_by_country_worker:
    build:
      context: ./server
      dockerfile: worker/filter_by_country/Dockerfile
    depends_on:
      - rabbitmq
    volumes:
      - ./server/worker/filter_by_country:/app
      - ./server/rabbitmq:/app/rabbitmq
      - ./server/common:/app/common
    deploy:
      replicas: 2

  top_5_budget_worker:
    build:
      context: ./server
      dockerfile: worker/top_5_budget/Dockerfile
    depends_on:
      - rabbitmq
    volumes:
      - ./server/worker/top_5_budget:/app
      - ./server/rabbitmq:/app/rabbitmq
      - ./server/common:/app/common

  countries_budget_worker:
    build:
      context: ./server
      dockerfile: worker/countries_budget/Dockerfile
    depends_on:
      - rabbitmq
    volumes:
      - ./server/worker/countries_budget:/app
      - ./server/rabbitmq:/app/rabbitmq
      - ./server/common:/app/common
